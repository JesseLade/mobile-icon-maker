workflows:
  raylib_ios_build:
    name: Raylib iOS Build Demi ðŸ’–
    environment:
      xcode: latest
      cocoapods: default
    scripts:
      - name: Build Raylib static lib
        script: |
          mkdir -p raylib/build-ios
          cd raylib/build-ios
          cmake ../src \
            -DCMAKE_TOOLCHAIN_FILE=$HOME/.cmake/ios.toolchain.cmake \
            -DCMAKE_BUILD_TYPE=Release \
            -DPLATFORM=OS
          make


      - name: Clone Raylib
        script: |
          git submodule update --init --recursive

      - name: Install Tools
        script: |
          brew install cmake ninja

      - name: Download iOS CMake Toolchain
        script: |
          mkdir -p $HOME/.cmake
          curl -L https://raw.githubusercontent.com/leetal/ios-cmake/master/ios.toolchain.cmake -o $HOME/.cmake/ios.toolchain.cmake

      - name: Build App 
        script: |
          # Clone raylib if missing or incomplete
          if [ ! -d "raylib/src" ]; then
            echo "Raylib sources not found, cloning raylib repo with submodules..."
            git clone --recursive https://github.com/raysan5/raylib.git raylib
          else
            echo "Raylib directory found, updating submodules..."
            cd raylib
            git submodule update --init --recursive
            cd ..
          fi

          mkdir -p build
          cd build

          cmake .. \
            -G "Unix Makefiles" \
            -DCMAKE_TOOLCHAIN_FILE=$HOME/.cmake/ios.toolchain.cmake \
            -DPLATFORM=OS \
            -DCMAKE_BUILD_TYPE=Release

          make


      - name: Package .ipa
        script: |
          mkdir -p Payload/icon_maker.app
          cp -R build/icon_maker.app/* Payload/icon_maker.app/
          zip -r raylib_icon_maker.ipa Payload

    artifacts:
      - raylib_icon_maker.ipa
